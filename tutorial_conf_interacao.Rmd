
---
title: "Tutorial de Confundimento e Interação no R"
author: "Anderson Lineu"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    number_sections: true
---

# Introdução

Neste tutorial, exploraremos como lidar com **confundimento** e **interação** em análises epidemiológicas usando **R**. Vamos trabalhar com um banco de dados fictício, mas as técnicas apresentadas são aplicáveis a qualquer análise de regressão logística.

Para ilustrar o uso de variáveis de confundimento e interação, usaremos o banco de dados `VIGITEL`, onde o desfecho de interesse será a variável `saruim` (presença de uma condição de saúde ruim), e a exposição de interesse será `inatividade física`.

# Importando o Banco de Dados

Vamos começar carregando o banco de dados e preparando as variáveis.

```{r, warning=FALSE, message=FALSE}
# Pacotes necessários
library(tableone)
library(sjPlot)

# Importando o banco de dados VIGITEL:
vigitelSL <- read.csv2("Vigitel2019_SaoLuis.csv")

# Renomeando as variáveis e transformando-as em fatores
vigitelSL$saruim <- factor(vigitelSL$saruim, labels = c("Não", "Sim"))
vigitelSL$idade <- vigitelSL$q6
vigitelSL$sexo <- factor(vigitelSL$q7, labels = c("Masculino", "Feminino"))
vigitelSL$fesc <- factor(vigitelSL$fesc, labels = c("0 a 8 anos", "9 a 11 anos", "12 anos e mais"))
vigitelSL$inativo <- factor(vigitelSL$inativo, labels = c("Não", "Sim"))

# Visualizando tabelas de frequência das variáveis
table(vigitelSL$saruim)
table(vigitelSL$sexo)
table(vigitelSL$fesc)
table(vigitelSL$inativo)
```

# Criando a Tabela 1

A **Tabela 1** é uma tabela descritiva comum em estudos epidemiológicos. Ela apresenta as distribuições de variáveis de interesse, estratificadas pelo desfecho.

```{r}
# Função para criar a Tabela 1
criar_tabela <- function(data, ..., estratificacao) {
  variaveis <- c(...)
  tabela <- CreateTableOne(data = data, vars = variaveis, strata = estratificacao)
  print(tabela, showAllLevels = TRUE)
}

# Criando a Tabela 1 estratificada por saruim
criar_tabela(vigitelSL, variaveis = "idade", "sexo", "fesc", "inativo", estratificacao = "saruim")
```

# Ajustando o Modelo Bruto

Neste passo, ajustamos o **modelo bruto**, ou seja, um modelo que avalia a associação direta entre a exposição (inatividade física) e o desfecho (`saruim`), sem ajustar para outras covariáveis.

```{r}
# Ajustando o modelo bruto
modbruto <- glm(saruim ~ inativo, family = binomial(logit), data = vigitelSL)
summary(modbruto)

# Calculando as ORs e IC 95%
tab_model(modbruto)
```

No modelo acima, a **odds ratio (OR)** nos informa a associação entre ser inativo e ter o desfecho `saruim`. Podemos ver a magnitude da associação diretamente no resultado.

# Avaliando Confundimento

### O que é Confundimento?

Uma variável é considerada **confundidora** quando está associada tanto à exposição quanto ao desfecho, mas não é uma variável intermediária no caminho causal. O ajuste para variáveis confundidoras pode alterar a magnitude da associação entre a exposição e o desfecho.

Aqui vamos testar se a **idade** e a **escolaridade** são variáveis confundidoras.

### Ajustando o Modelo com Idade

```{r}
# Ajustando o modelo com idade
modajust1 <- glm(saruim ~ inativo + idade, family = binomial(logit), data = vigitelSL)
summary(modajust1)

# Calculando as ORs e IC 95%
tab_model(modajust1)
```

### Ajustando o Modelo com Idade e Escolaridade

```{r}
# Ajustando o modelo com idade e escolaridade
modajust2 <- glm(saruim ~ inativo + idade + fesc, family = binomial(logit), data = vigitelSL)
summary(modajust2)

# Calculando as ORs e IC 95%
tab_model(modajust2)
```

Aqui, comparamos o modelo bruto e o ajustado para idade e escolaridade.

```{r}
# Comparando os modelos ajustados e o modelo bruto
tab_model(modbruto, modajust1, modajust2)
```

# Testando Interação

### O que é Interação?

A **interação** ocorre quando o efeito da exposição no desfecho varia em função de uma terceira variável, chamada de modificadora de efeito. Aqui, vamos testar se o **sexo** é uma variável modificadora do efeito da inatividade física no desfecho `saruim`.

### Modelo com Interação

```{r}
# Ajustando o modelo com interação entre inatividade e sexo
modint <- glm(saruim ~ inativo * sexo, family = binomial(logit), data = vigitelSL)
summary(modint)

# Testando a significância da interação com LRT
anova(modint, test = "LRT")
```

O teste de **razão de verossimilhança (LRT)** nos ajuda a avaliar se a interação entre `inativo` e `sexo` melhora significativamente o modelo.

### Estratificando por Sexo

Outra abordagem para lidar com a interação é estratificar o banco de dados por sexo e ajustar os modelos separadamente.

```{r}
# Estratificando por sexo
vigitelSL1 <- subset(vigitelSL, sexo == "Masculino")
modsexo1 <- glm(saruim ~ inativo, family = binomial(logit), data = vigitelSL1)

vigitelSL2 <- subset(vigitelSL, sexo == "Feminino")
modsexo2 <- glm(saruim ~ inativo, family = binomial(logit), data = vigitelSL2)

# Exibindo os modelos estratificados
tab_model(modsexo1, modsexo2)
```

# Regressão Logística com Pesos

Quando os dados são resumidos (ou seja, agrupados por frequência), podemos ajustar um modelo logístico ponderado usando a função `weights`.

```{r}
# Criando um banco de dados resumido
inativo <- c(1, 1, 0, 0)
saruim <- c(1, 0, 1, 0)
n <- c(31, 338, 63, 1633)
banco <- data.frame(inativo, saruim, n)

# Ajustando o modelo com pesos
mod <- glm(saruim ~ inativo, family = binomial(logit), weights = n, data = banco)
summary(mod)

# Comparando com o modelo original
tab_model(mod)
```

Neste exemplo, o uso de **pesos** no modelo permite ajustar corretamente um modelo com dados resumidos, utilizando as frequências para representar o número de observações em cada grupo.

# Conclusão

Este tutorial demonstrou como ajustar modelos de regressão logística em R para avaliar **confundimento** e **interação**. Além disso, mostramos como utilizar pesos para trabalhar com dados resumidos. A compreensão desses conceitos é essencial em análises epidemiológicas, onde a identificação de confundidores e modificadores de efeito pode alterar as interpretações dos resultados.
